<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>YO, THAT'S HEAT</title>
    <link rel="stylesheet" href="./assets/nes.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="./assets/toastify.css" />
  </head>
  <body>
    <!-- Main Menu -->
    <div id="main-menu" class="screen active">
      <div class="menu-container">
        <img src="./assets/art/logo.png" id="logo" draggable="false" />
        <p class="subtitle">!! Create heat beatz with friends !!</p>
        <div class="menu-buttons">
          <button id="tutorial-btn" class="menu-button nes-btn">
            Tutorial
          </button>
          <button id="create-lobby-btn" class="menu-button nes-btn is-primary">
            Create Lobby
          </button>
          <button id="join-lobby-btn" class="menu-button nes-btn">
            Join Lobby
          </button>
        </div>
      </div>
    </div>

    <!-- Create Lobby -->
    <div id="create-lobby" class="screen">
      <div class="lobby-container">
        <h2>Create Lobby</h2>
        <div class="form-group">
          <label for="player-name">Your Name:</label>
          <input
            type="text"
            id="player-name"
            placeholder="Enter your name"
            maxlength="20"
            class="nes-input"
          />
        </div>
        <div class="lobby-buttons">
          <button
            id="create-lobby-confirm-btn"
            class="primary-button nes-btn is-success"
          >
            Create Lobby
          </button>
          <button
            id="back-to-menu-btn"
            class="secondary-button nes-btn is-error"
          >
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- Join Lobby -->
    <div id="join-lobby" class="screen">
      <div class="lobby-container">
        <h2>Join Lobby</h2>
        <div class="form-group">
          <label for="join-player-name">Your Name:</label>
          <input
            type="text"
            id="join-player-name"
            placeholder="Enter your name"
            maxlength="20"
            class="nes-input"
          />
        </div>
        <div class="form-group">
          <label for="lobby-code">Lobby Code:</label>
          <input
            class="nes-input"
            type="text"
            id="lobby-code"
            placeholder="Enter lobby code"
            maxlength="6"
            autocomplete="off"
            style="text-transform: uppercase"
          />
        </div>
        <div class="lobby-buttons">
          <button
            id="join-lobby-confirm-btn"
            class="primary-button nes-btn is-success"
          >
            Join Lobby
          </button>
          <button
            id="back-to-menu-from-join-btn"
            class="secondary-button nes-btn is-error"
          >
            Back
          </button>
        </div>
      </div>
    </div>

    <!-- Lobby Waiting Room -->
    <div id="lobby-waiting" class="screen">
      <div class="lobby-container">
        <h2>Lobby: <span id="lobby-code-display"></span></h2>
        <div class="connection-status">
          <span id="connection-indicator" class="connected">●</span>
          <span>Connected to server</span>
        </div>

        <div class="players-list">
          <h3>Players (<span id="player-count">0</span>):</h3>
          <div id="players-container">
            <!-- Players will be populated here -->
          </div>
        </div>

        <div class="lobby-info">
          <p style="font-family: readableFont; font-size: x-large">
            Share this code with friends: <strong id="shareable-code"></strong>
          </p>
          <p>Minimum 2 players required to start</p>
        </div>

        <div class="lobby-buttons">
          <button id="ready-btn" class="primary-button nes-btn">Ready</button>
          <button
            id="leave-lobby-btn"
            class="secondary-button nes-btn is-error"
          >
            Leave Lobby
          </button>
        </div>

        <div id="game-starting" class="game-starting" style="display: none">
          <h3>All players ready! Starting game...</h3>
          <div class="countdown-circle">
            <span id="start-countdown">3</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tutorial Overlay -->
    <div id="tutorial" class="screen overlay">
      <div class="tutorial-content" style="overflow: auto">
        <h2>How to Play</h2>
        <div class="tutorial-steps">
          <div class="step">
            <h3>1. Sound Selection (30 seconds)</h3>
            <p>
              Pick exactly 3 sounds from 5 random options. Hover to preview,
              click to select. Click again to unselect.
            </p>
          </div>
          <div class="step">
            <h3>2. Performance Phase (1.5 minutes)</h3>
            <p>
              Press keys 1, 2, 3 to place down your chosen sounds and record
              them with the backing track.
            </p>
          </div>
          <div class="step">
            <h3>3. Editing Phase (1 minute)</h3>
            <p>
              Press the 1, 2, 3 buttons to change to your desired sound. Drag
              notes up/down to change their pitch. Create your perfect melody!
            </p>
          </div>
          <div class="step">
            <h3>Listen to previous players creation (30 seconds</h3>
            <p>
              Preview the previous players creation and try to think of creative
              ways to keep it going.
            </p>
          </div>
          <div class="step">
            <h3>Swap a sound (30 seconds)</h3>
            <p>
              Choose one sound to swap, we don't want every track sounding the
              same!
            </p>
          </div>
          <div class="step">
            <h3>4. Final Playback</h3>
            <p>Listen to the awesome creations you made!</p>
          </div>
        </div>
        <div class="tutorial-buttons">
          <button id="skip-tutorial-btn" class="nes-btn">Back</button>
        </div>
      </div>
    </div>

    <!-- Sound Selection -->
    <div id="selection" class="screen oven">
      <div class="selection-header">
        <h2>Choose 3 Sounds</h2>
        <div class="countdown" id="selection-countdown">10</div>
      </div>
      <div class="sound-grid" id="sound-grid">
        <!-- Sound icons will be populated here -->
      </div>
      <div class="selection-footer">
        <div class="selected-count">
          Selected: <span id="selected-count">0</span>/3
        </div>
        <button id="continue-btn" class="nes-btn is-disabled" disabled>
          Continue
        </button>
      </div>
    </div>

    <!-- Performance Phase -->
    <div id="performance" class="screen oven">
      <div class="phase-container">
        <div class="phase-header">
          <h2>Record That Heat</h2>
          <div class="countdown" id="performance-countdown">--</div>
        </div>

        <p class="phase-instructions">
          Press 1, 2 or 3 to place notes. Right click a note to delete it.
        </p>

        <div class="phase-sounds">
          <div class="sound-key">
            <span class="key">
              <img src="assets/art/oneButton.png" alt="1" draggable="false" />
            </span>
            <div class="sound-icon">
              <img
                src="assets/art/record.png"
                class="over-img"
                draggable="false"
              />
              <img id="sound-1-icon" class="bg-image" alt="" />
            </div>
          </div>
          <div class="sound-key">
            <span class="key">
              <img src="assets/art/twoButton.png" alt="2" draggable="false" />
            </span>
            <div class="sound-icon">
              <img
                src="assets/art/blueRecord.png"
                class="over-img"
                draggable="false"
              />
              <img id="sound-2-icon" class="bg-image" alt="" />
            </div>
          </div>
          <div class="sound-key">
            <span class="key">
              <img src="assets/art/threeButton.png" alt="3" draggable="false" />
            </span>
            <div class="sound-icon">
              <img
                src="assets/art/greenRecord.png"
                class="over-img"
                draggable="false"
              />
              <img id="sound-3-icon" class="bg-image" alt="" />
            </div>
          </div>
        </div>

        <div class="timeline-container">
          <canvas id="timeline-canvas" width="800" height="200"></canvas>
        </div>

        <div class="transport-controls">
          <button
            id="play-pause-btn"
            class="control-button play-pause-btn"
          ></button>
          <button id="restart-btn" class="control-button rewind-btn"></button>
          <div class="progress-container">
            <input
              type="range"
              id="progress-bar"
              min="0"
              max="8"
              step="0.1"
              value="0"
            />
            <span id="time-display">0.0 / 8.0</span>
          </div>
          <button id="performance-continue-btn" class="primary-button nes-btn">
            Proceed to Tuning Phase
          </button>
        </div>
      </div>
    </div>

    <!-- Editing Phase -->
    <div id="editing" class="screen oven">
      <div class="phase-container">
        <div class="phase-header">
          <h2>Mix That Heat</h2>
          <div class="countdown" id="editing-countdown">--</div>
        </div>

        <p class="phase-instructions">
          Drag notes to pitch them! Press 1, 2, or 3 to change the type.
        </p>

        <div class="phase-sounds">
          <div class="sound-key phase-sound-selectable" id="editing-sound-0">
            <span class="key">
              <img src="assets/art/oneButton.png" alt="1" draggable="false" />
            </span>
            <div class="sound-icon">
              <img
                src="assets/art/record.png"
                class="over-img"
                draggable="false"
              />
              <img
                src="assets/art/record.png"
                id="editing-sound-1-icon"
                class="bg-image"
                alt=""
              />
            </div>
          </div>
          <div class="sound-key phase-sound-selectable" id="editing-sound-1">
            <span class="key">
              <img src="assets/art/twoButton.png" alt="2" draggable="false" />
            </span>
            <div class="sound-icon">
              <img
                src="assets/art/blueRecord.png"
                class="over-img"
                draggable="false"
              />
              <img
                src="assets/art/blueRecord.png"
                id="editing-sound-2-icon"
                class="bg-image"
                alt=""
              />
            </div>
          </div>
          <div class="sound-key phase-sound-selectable" id="editing-sound-2">
            <span class="key">
              <img src="assets/art/threeButton.png" alt="3" draggable="false" />
            </span>
            <div class="sound-icon">
              <img
                src="assets/art/greenRecord.png"
                class="over-img"
                draggable="false"
              />
              <img
                src="assets/art/greenRecord.png"
                id="editing-sound-3-icon"
                class="bg-image"
                alt=""
              />
            </div>
          </div>
        </div>

        <div class="timeline-container">
          <canvas
            id="editing-timeline-canvas"
            width="800"
            height="400"
          ></canvas>
        </div>

        <div class="transport-controls">
          <button
            id="edit-play-pause-btn"
            class="control-button play-pause-btn"
          ></button>
          <button
            id="edit-restart-btn"
            class="control-button rewind-btn"
          ></button>
          <div class="progress-container">
            <input
              type="range"
              id="edit-progress-bar"
              min="0"
              max="8"
              step="0.1"
              value="0"
            />
            <span id="edit-time-display">0.0 / 8.0</span>
          </div>
          <button id="editing-continue-btn" class="primary-button nes-btn">
            Done
          </button>
        </div>
      </div>
    </div>

    <!-- Waiting for Players -->
    <div id="waiting-for-players" class="screen">
      <div class="waiting-container">
        <h2>Waiting for Everyone to Finish...</h2>
        <div class="waiting-info">
          <p id="waiting-message">...</p>
          <div class="round-info">
            <span
              >Round <span id="current-round">1</span> of
              <span id="total-rounds">3</span></span
            >
          </div>
        </div>

        <div class="loading-spinner">
          <div class="spinner"></div>
        </div>
      </div>
    </div>

    <!-- Song Preview -->
    <div id="preview" class="screen oven">
      <div class="preview-container">
        <div class="phase-header">
          <h2>Listen to the Previous Part</h2>
          <div class="countdown" id="preview-phase-timer">30</div>
        </div>
        <div class="phase-info">
          <p>
            This is what <span id="previous-player-name">Player</span> created.
          </p>
          <p>You'll be making a continuation to this!</p>
          <div class="round-info">
            <span
              >Round <span id="preview-current-round">2</span> of
              <span id="preview-total-rounds">3</span></span
            >
          </div>
        </div>

        <div class="preview-timeline-container">
          <canvas id="preview-canvas" width="800" height="200"></canvas>
        </div>

        <div class="transport-controls">
          <button
            id="preview-play-pause-btn"
            class="control-button play-pause-btn"
          ></button>
          <button
            id="preview-restart-btn"
            class="control-button rewind-btn"
          ></button>
          <div class="progress-container">
            <input
              type="range"
              id="preview-progress-bar"
              min="0"
              max="8"
              step="0.1"
              value="0"
            />
            <span id="preview-time-display">0.0 / 8.0</span>
          </div>
        </div>

        <div class="phase-buttons">
          <button
            id="continue-to-performance-btn"
            class="primary-button nes-btn"
          >
            Continue to Add Your Part
          </button>
        </div>
      </div>
    </div>

    <!-- Sound Replacement -->
    <div id="sound-replacement" class="screen oven">
      <div class="replacement-container">
        <div class="phase-header">
          <h2>Evolve Your Sound Palette</h2>
          <div class="countdown" id="replacement-countdown">10</div>
        </div>
        <div class="replacement-info">
          <p>Replace one sound from the previous players 3 chosen sounds!</p>
          <div class="replacement-target">
            <span>Replacing: </span>
            <div class="current-sound">
              <img
                id="replacement-target-icon"
                class="sound-icon"
                style="animation: none"
                alt="Current Sound"
                draggable="false"
              />
              <span>Sound <span id="replacement-target-number">1</span></span>
            </div>
          </div>
        </div>

        <div class="replacement-grid" id="replacement-grid">
          <!-- Sound options will be populated here -->
        </div>

        <div class="replacement-footer">
          <div class="replacement-selected">
            <span id="replacement-status">Choose a replacement sound</span>
          </div>
          <button
            id="replacement-continue-btn"
            class="primary-button nes-btn is-disabled"
            disabled
          >
            Continue
          </button>
        </div>
      </div>
    </div>

    <!-- Final Showcase -->
    <div id="showcase" class="screen party">
      <div class="showcase-container">
        <h2>Yo, That's Heat!</h2>
        <div class="phase-info">
          <p>Listen and jam out to everyones finished songs!</p>
          <div class="song-navigation">
            <span
              >Song <span id="current-song-number">1</span> of
              <span id="total-songs">3</span></span
            >
            <div class="song-info">
              <p>
                Created by:
                <span id="song-creators">Player1, Player2, Player3</span>
              </p>
            </div>
          </div>
        </div>

        <div class="showcase-timeline-container">
          <canvas id="showcase-canvas" width="800" height="400"></canvas>
        </div>

        <div class="transport-controls">
          <button
            id="showcase-play-pause-btn"
            class="control-button play-pause-btn"
          ></button>
          <button
            id="showcase-restart-btn"
            class="control-button rewind-btn"
          ></button>
          <div class="progress-container">
            <input
              type="range"
              id="showcase-progress-bar"
              min="0"
              max="24"
              step="0.1"
              value="0"
            />
            <span id="showcase-time-display">0.0 / 24.0</span>
          </div>
        </div>

        <div class="phase-buttons">
          <button id="prev-song-btn" class="secondary-button nes-btn">
            ← Previous Song
          </button>
          <button id="next-song-btn" class="secondary-button nes-btn">
            Next Song →
          </button>
          <button
            id="showcase-exit-btn"
            class="primary-button nes-btn is-error"
          >
            Exit
          </button>
        </div>
      </div>
    </div>

    <!-- Error Dialog -->
    <dialog class="nes-dialog error-dialog" id="error-dialog">
      <form method="dialog" class="dialog-form">
        <p class="title">Error</p>
        <p class="message" id="error-message"></p>
        <menu class="dialog-menu">
          <button class="nes-btn is-primary">OK</button>
        </menu>
      </form>
    </dialog>

    <script src="./assets/toastify.js"></script>
    <script type="module" src="js/Game.js"></script>
  </body>
</html>
